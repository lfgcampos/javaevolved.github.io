{
  "id": 48,
  "slug": "scoped-values",
  "title": "Scoped values",
  "category": "concurrency",
  "difficulty": "advanced",
  "jdkVersion": "25",
  "oldLabel": "Java 8",
  "modernLabel": "Java 25",
  "oldApproach": "ThreadLocal",
  "modernApproach": "ScopedValue",
  "oldCode": "static final ThreadLocal<User> CURRENT =\n    new ThreadLocal<>();\nvoid handle(Request req) {\n    CURRENT.set(authenticate(req));\n    try { process(); }\n    finally { CURRENT.remove(); }\n}",
  "modernCode": "static final ScopedValue<User> CURRENT =\n    ScopedValue.newInstance();\nvoid handle(Request req) {\n    ScopedValue.where(CURRENT,\n        authenticate(req)\n    ).run(this::process);\n}",
  "summary": "Share data across call stacks safely without ThreadLocal pitfalls.",
  "explanation": "ScopedValue provides immutable, inheritable, scope-limited context. Unlike ThreadLocal, scoped values are automatically cleaned up, work with virtual threads, and can't be mutated by callees.",
  "whyModernWins": [
    {
      "icon": "ðŸ”’",
      "title": "Immutable",
      "desc": "Callees can read but never modify the scoped value."
    },
    {
      "icon": "ðŸ§¹",
      "title": "Auto cleanup",
      "desc": "No manual remove() â€” value is scoped to the block."
    },
    {
      "icon": "âš¡",
      "title": "Virtual-thread safe",
      "desc": "Works efficiently with millions of virtual threads."
    }
  ],
  "support": "Finalized in JDK 25 LTS (JEP 506, Sept 2025).",
  "prev": "concurrency/structured-concurrency",
  "next": "concurrency/stable-values",
  "related": [
    "concurrency/virtual-threads",
    "concurrency/structured-concurrency",
    "concurrency/stable-values"
  ]
}
