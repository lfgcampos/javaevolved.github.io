{
  "id": 97,
  "slug": "file-memory-mapping",
  "title": "File memory mapping",
  "category": "io",
  "difficulty": "advanced",
  "jdkVersion": "22",
  "oldLabel": "Java 8",
  "modernLabel": "Java 22+",
  "oldApproach": "MappedByteBuffer",
  "modernApproach": "MemorySegment with Arena",
  "oldCode": "try (FileChannel channel =\n    FileChannel.open(path,\n        StandardOpenOption.READ,\n        StandardOpenOption.WRITE)) {\n    MappedByteBuffer buffer =\n        channel.map(\n            FileChannel.MapMode.READ_WRITE,\n            0, (int) channel.size());\n    // Limited to 2GB\n    // Freed by GC, no control\n}",
  "modernCode": "FileChannel channel =\n    FileChannel.open(path,\n        StandardOpenOption.READ,\n        StandardOpenOption.WRITE);\ntry (Arena arena = Arena.ofShared()) {\n    MemorySegment segment =\n        channel.map(\n            FileChannel.MapMode.READ_WRITE,\n            0, channel.size(), arena);\n    // No size limit\n    // ...\n} // Deterministic cleanup",
  "summary": "Map files larger than 2GB with deterministic cleanup using MemorySegment.",
  "explanation": "The Foreign Function & Memory API (JEP 454) introduces MemorySegment for safe and efficient memory access. Unlike MappedByteBuffer, MemorySegment supports files larger than 2GB (Integer.MAX_VALUE), provides deterministic cleanup via Arena, and offers better performance with modern hardware.",
  "whyModernWins": [
    {
      "icon": "üìè",
      "title": "No size limit",
      "desc": "Map files larger than 2GB without workarounds."
    },
    {
      "icon": "üîí",
      "title": "Deterministic cleanup",
      "desc": "Arena ensures memory is freed at scope exit, not GC time."
    },
    {
      "icon": "‚ö°",
      "title": "Better performance",
      "desc": "Aligned with modern memory models and hardware."
    }
  ],
  "support": {
    "state": "available",
    "description": "Available since JDK 22 (March 2024)"
  },
  "prev": "io/try-with-resources-effectively-final",
  "next": "io/files-mismatch",
  "related": [
    "io/http-client",
    "io/reading-files",
    "io/writing-files"
  ]
}
