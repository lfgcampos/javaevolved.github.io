# Copilot Instructions for java.evolved

## Project Overview

This is a static site showcasing modern Java patterns vs legacy approaches.
It is hosted on GitHub Pages at https://javaevolved.github.io.

## Architecture

### Source of Truth: JSON Files

Each pattern is defined as a JSON file under **`content/category/`**:

```
content/language/type-inference-with-var.json
content/collections/immutable-list-creation.json
content/streams/stream-tolist.json
...
```

**Categories:** `language`, `collections`, `strings`, `streams`, `concurrency`, `io`, `errors`, `datetime`, `security`, `tooling`, `enterprise`

### Generated Files (DO NOT EDIT)

The following are **generated by `html-generators/generate.java`** and must not be edited directly:

- `site/index.html` ‚Äî English homepage with preview cards (generated from `templates/index.html`)
- `site/language/*.html`, `site/collections/*.html`, etc. ‚Äî English detail pages
- `site/data/snippets.json` ‚Äî English aggregated search index
- `site/{locale}/index.html` ‚Äî localized homepage (e.g., `site/es/index.html`)
- `site/{locale}/language/*.html`, etc. ‚Äî localized detail pages
- `site/{locale}/data/snippets.json` ‚Äî localized search index

Run `jbang html-generators/generate.java` to rebuild all generated files from the JSON sources and translations.

### Manually Maintained Files

- `site/app.js` ‚Äî client-side search, filtering, code highlighting, locale detection
- `site/styles.css` ‚Äî all styling
- `templates/slug-template.html` ‚Äî HTML template with `{{placeholder}}` tokens (content + UI strings) used by the generator
- `templates/index.html` ‚Äî homepage template with `{{tipCards}}`, `{{snippetCount}}`, and UI string placeholders
- `templates/index-card.html` ‚Äî preview card template for the homepage grid
- `html-generators/categories.properties` ‚Äî category ID ‚Üí display name mapping
- `html-generators/locales.properties` ‚Äî supported locales registry (locale=Display name)
- `translations/strings/{locale}.yaml` ‚Äî UI strings per locale (labels, nav, footer, etc.)
- `translations/content/{locale}/` ‚Äî translated pattern JSON files (partial, translatable fields only)

### Project Structure

```
content/            # English content JSON files (source of truth, one per pattern)
translations/       # All i18n artifacts
  strings/          # UI strings per locale (en.yaml, es.yaml, pt-BR.yaml)
  content/          # Translated pattern files per locale (partial, translatable fields only)
    es/             # Spanish translations (mirrors content/ folder structure)
    pt-BR/          # Brazilian Portuguese translations
site/               # Deployable site (static assets + generated HTML)
  es/               # Generated Spanish pages
  pt-BR/            # Generated Portuguese pages
templates/          # HTML templates with {{‚Ä¶}} tokens for content + UI strings
html-generators/    # Build scripts, categories.properties, locales.properties
specs/              # Feature specifications (e.g., i18n-spec.md)
```

## JSON Snippet Schema

Each `content/category/slug.json` file has this structure:

```json
{
  "id": 1,
  "slug": "type-inference-with-var",
  "title": "Type inference with var",
  "category": "language",
  "difficulty": "beginner|intermediate|advanced",
  "jdkVersion": "10",
  "oldLabel": "Java 8",
  "modernLabel": "Java 10+",
  "oldApproach": "Explicit Types",
  "modernApproach": "var keyword",
  "oldCode": "// old way...",
  "modernCode": "// modern way...",
  "summary": "One-line description.",
  "explanation": "How it works paragraph.",
  "whyModernWins": [
    { "icon": "‚ö°", "title": "Short title", "desc": "One sentence." },
    { "icon": "üëÅ", "title": "Short title", "desc": "One sentence." },
    { "icon": "üîí", "title": "Short title", "desc": "One sentence." }
  ],
  "support": {
    "state": "available",
    "description": "Widely available since JDK 10 (March 2018)"
  },
  "prev": "category/slug-of-previous",
  "next": "category/slug-of-next",
  "related": [
    "category/slug-1",
    "category/slug-2",
    "category/slug-3"
  ],
  "docs": [
    { "title": "Javadoc or Guide Title", "href": "https://docs.oracle.com/..." }
  ]
}
```

### Key Rules

- `slug` must match the filename (without `.json`)
- `category` must match the parent folder name
- `whyModernWins` must have exactly **3** entries
- `related` must have exactly **3** entries (as `category/slug` paths)
- `docs` must have at least **1** entry linking to Javadoc or Oracle documentation
- `prev`/`next` are `category/slug` paths or `null` for first/last
- Code in `oldCode`/`modernCode` uses `\n` for newlines

## Category Display Names

Categories and their display names are defined in `html-generators/categories.properties`:

| ID | Display |
|----|---------|
| `language` | Language |
| `collections` | Collections |
| `strings` | Strings |
| `streams` | Streams |
| `concurrency` | Concurrency |
| `io` | I/O |
| `errors` | Errors |
| `datetime` | Date/Time |
| `security` | Security |
| `tooling` | Tooling |
| `enterprise` | Enterprise |

## Adding a New Pattern

1. Create `content/category/new-slug.json` with all required fields
2. Update `prev`/`next` in the adjacent patterns' JSON files
3. Run `jbang html-generators/generate.java`
4. (Optional) Create translated content files under `translations/content/{locale}/category/new-slug.json` with only translatable fields ‚Äî or let the AI translation workflow handle it

## Internationalization (i18n)

The site supports multiple languages. See `specs/i18n/i18n-spec.md` for the full specification.

### Key Concepts

- **UI strings:** Hard-coded template text (labels, nav, footer) is extracted into `translations/strings/{locale}.yaml`. Templates use `{{dotted.key}}` tokens (e.g., `{{nav.allPatterns}}`, `{{sections.codeComparison}}`). Missing keys fall back to the English value with a build-time warning.
- **Content translations:** Translated pattern files under `translations/content/{locale}/` contain **only** translatable fields (`title`, `summary`, `explanation`, `oldApproach`, `modernApproach`, `whyModernWins`, `support.description`). All other fields (`oldCode`, `modernCode`, `slug`, `id`, `prev`, `next`, `related`, `docs`, etc.) are always taken from the English source.
- **Locale registry:** `html-generators/locales.properties` lists supported locales (format: `locale=Display name`). The first entry is the default.
- **English is a first-class locale:** All locales ‚Äî including English ‚Äî go through the same build pipeline.
- **Fallback:** If a pattern has no translation file for a locale, the English content is used and an "untranslated" banner is shown.

### Supported Locales

Defined in `html-generators/locales.properties`:

| Locale | Display Name |
|--------|-------------|
| `en` | English |
| `es` | Espa√±ol |
| `pt-BR` | Portugu√™s (Brasil) |

### Content Translation File Example

Translation files contain **only** translatable fields ‚Äî no structural data:

```json
// translations/content/pt-BR/language/type-inference-with-var.json
{
  "title": "Infer√™ncia de tipo com var",
  "oldApproach": "Tipos expl√≠citos",
  "modernApproach": "Palavra-chave var",
  "summary": "Use var para deixar o compilador inferir o tipo local.",
  "explanation": "...",
  "whyModernWins": [
    { "icon": "‚ö°", "title": "Menos ru√≠do", "desc": "..." },
    { "icon": "üëÅ",  "title": "Mais leg√≠vel", "desc": "..." },
    { "icon": "üîí", "title": "Seguro", "desc": "..." }
  ],
  "support": {
    "description": "Amplamente dispon√≠vel desde o JDK 10 (mar√ßo de 2018)"
  }
}
```

## Local Development

```bash
jbang html-generators/generate.java  # Build HTML pages + snippets.json
jwebserver -d site -p 8090              # Serve locally
```
